{"componentChunkName":"component---src-templates-content-template-js","path":"/fr/part3/deployer_votre_application_sur_internet","result":{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<p>Ensuite, nous allons connecter le frontend que nous avons créé dans la <a href=\"/fr/part2\">partie 2</a> à notre propre backend.</p>\n<p>Dans la partie précédente, le frontend pouvait demander la liste des notes au serveur json que nous avions comme backend, à l'adresse <a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a>.\nNotre backend a une structure d'url légèrement différente maintenant, puisque les notes peuvent être trouvées à <a href=\"http://localhost:3001/api/notes\">http://localhost:3001/api/notes</a>. Changeons l'attribut <strong>baseUrl</strong> dans le <i>src/services/notes.js</i> comme ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'http://localhost:3001/api/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span> getAll<span class=\"token punctuation\">,</span> create<span class=\"token punctuation\">,</span> update <span class=\"token punctuation\">}</span></code></pre></div>\n<!-- Frontendin tekemä GET-pyyntö osoitteeseen <http://localhost:3001/api/notes> ei jostain syystä toimi : --> \n<p>Maintenant la requête GET du frontend vers <a href=\"http://localhost:3001/api/notes\">http://localhost:3001/api/notes</a> ne fonctionne pas pour une raison quelconque :</p>\n<p> <picture><img src=\"/static/da88e17cb078c89a6e7ba30d61fab0e6/5a190/3ae.png\" srcset=\"/static/da88e17cb078c89a6e7ba30d61fab0e6/772e8/3ae.png 200w,\n/static/da88e17cb078c89a6e7ba30d61fab0e6/e17e5/3ae.png 400w,\n/static/da88e17cb078c89a6e7ba30d61fab0e6/5a190/3ae.png 800w,\n/static/da88e17cb078c89a6e7ba30d61fab0e6/c1b63/3ae.png 1200w,\n/static/da88e17cb078c89a6e7ba30d61fab0e6/29007/3ae.png 1600w,\n/static/da88e17cb078c89a6e7ba30d61fab0e6/6e29b/3ae.png 1610w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture></p>\n <!-- Mistä on kyse ? Backend toimii kuitenkin selaimesta ja postmanista käytettäessä ilman ongelmaa. --> \n<p>Qu'est-ce qui se passe ici ? Nous pouvons accéder au backend depuis un navigateur et depuis postman sans aucun problème.</p>\n<h3>Même politique d'origine et CORS</h3>\n<p>Le problème réside dans une chose appelée CORS, ou Cross-Origin Resource Sharing. </p>\n<p>Selon <a href=\"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing\">Wikipedia</a>:</p>\n<blockquote>\n<p><i>Cross-origin resource sharing (CORS) est un mécanisme qui permet aux ressources restreintes (par exemple, les polices) d'une page Web d'être demandées à partir d'un autre domaine en dehors du domaine à partir duquel la première ressource a été servie. Une page Web peut librement intégrer des images, des feuilles de style, des scripts, des iframes et des vidéos d'origine croisée. Certaines requêtes \"cross-domain\", notamment les requêtes Ajax, sont interdites par défaut par la politique de sécurité same-origin.</i></p>\n</blockquote>\n<p>Dans notre contexte, le problème est que, par défaut, le code JavaScript d'une application qui s'exécute dans un navigateur ne peut communiquer qu'avec un serveur dans la même <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">origine</a>.\nParce que notre serveur est sur le port 3001 de localhost, et notre frontend sur le port 3000 de localhost, ils n'ont pas la même origine.</p>\n<p>Gardez à l'esprit que la <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">politique de même origine</a> et CORS ne sont pas spécifiques à React ou Node. Ce sont en fait des principes universels du fonctionnement des applications web. </p>\n<p>Nous pouvons autoriser les demandes provenant d'autres <i>origines</i> en utilisant le middleware <a href=\"https://github.com/expressjs/cors\">cors</a> de Node.</p>\n<p>Dans votre dépôt de backend, installez <i>cors</i> avec la commande</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> cors</code></pre></div>\n<p>prenez le middleware à utiliser et autorisez les requêtes de toutes origines : </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cors'</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Et le frontend fonctionne ! Cependant, la fonctionnalité permettant de modifier l'importance des notes n'a pas encore été implémentée dans le backend. </p>\n<p>Vous pouvez en savoir plus sur les CORS sur la <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">page Mozillas</a>.</p>\n<p>La configuration de notre application est maintenant la suivante :</p>\n<p> <picture><img src=\"/static/2aa09f5e7969cf4ec229aceb70abfa26/664c8/100.png\" srcset=\"/static/2aa09f5e7969cf4ec229aceb70abfa26/772e8/100.png 200w,\n/static/2aa09f5e7969cf4ec229aceb70abfa26/e17e5/100.png 400w,\n/static/2aa09f5e7969cf4ec229aceb70abfa26/664c8/100.png 524w\" sizes=\"(max-width: 524px) 100vw, 524px\"></picture></p>\n<p> L'application react qui s'exécute dans le navigateur va maintenant chercher les données dans le node/express-server qui s'exécute sur localhost:3001.</p>\n<h3>Application vers l'Internet</h3>\n<p>Maintenant que toute la pile est prête, déplaçons notre application sur Internet. Nous allons utiliser le bon vieux [Heroku] (<a href=\"https://www.heroku.com\">https://www.heroku.com</a>) pour cela.</p>\n<blockquote>\n<p>Si vous n'avez jamais utilisé Heroku auparavant, vous pouvez trouver des instructions dans <a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs\">Heroku documentation</a> ou en cherchant sur Google.</p>\n</blockquote>\n<p>Ajoutez un fichier appelé <i>Procfile</i> à la racine du projet backend pour indiquer à Heroku comment démarrer l'application. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">web: <span class=\"token function\">node</span> index.js</code></pre></div>\n<p>Changez la définition du port que notre application utilise en bas du fichier <i>index.js</i> comme suit : </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3001</span></span>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Server running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Nous utilisons maintenant le port défini dans la <a href=\"https://en.wikipedia.org/wiki/Environment_variable\">variable d'environnement</a> <em>PORT</em> ou le port 3001 si la variable d'environnement <em>PORT</em> est indéfinie.\nHeroku configure le port de l'application en fonction de la variable d'environnement. </p>\n<p>Créez un dépôt Git dans le répertoire du projet, et ajoutez <i>.gitignore</i> avec le contenu suivant</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node_modules</code></pre></div>\n<p>Créez un compte Heroku dans <a href=\"https://devcenter.heroku.com/\">https://devcenter.heroku.com/</a>.\nInstallez le paquet Heroku en utilisant la commande : npm install -g heroku.\nCréez une application Heroku avec la commande <i>heroku create</i>, commitez votre code sur le dépôt et déplacez-le sur Heroku avec la commande <i>git push heroku main</i>.</p>\n<p>Si tout s'est bien passé, l'application fonctionne :</p>\n<picture><img src=\"/static/7e52f36bb453e8d8a730d4b2812764c1/5a190/25ea.png\" srcset=\"/static/7e52f36bb453e8d8a730d4b2812764c1/772e8/25ea.png 200w,\n/static/7e52f36bb453e8d8a730d4b2812764c1/e17e5/25ea.png 400w,\n/static/7e52f36bb453e8d8a730d4b2812764c1/5a190/25ea.png 800w,\n/static/7e52f36bb453e8d8a730d4b2812764c1/c1b63/25ea.png 1200w,\n/static/7e52f36bb453e8d8a730d4b2812764c1/fde66/25ea.png 1574w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Si ce n'est pas le cas, le problème peut être trouvé en lisant les logs de heroku avec la commande <i>heroku logs</i>.</p>\n<blockquote>\n<p><strong>NB</strong> Au moins au début, il est bon de garder un oeil sur les logs heroku à tout moment. La meilleure façon de le faire est avec la commande <i>heroku logs -t</i> qui imprime les logs à la console chaque fois que quelque chose se passe sur le serveur. </p>\n</blockquote>\n<blockquote>\n<p><strong>NB</strong> Si vous déployez depuis un dépôt git où votre code n'est pas sur la branche principale (c'est-à-dire si vous modifiez le <a href=\"https://github.com/fullstack-hy2020/part3-notes-backend/tree/part3-2\">dépôt notes</a> de la dernière leçon), vous devrez exécuter <em>git push heroku HEAD:master</em>. Si vous avez déjà effectué un push sur heroku, vous devrez peut-être exécuter <em>git push heroku HEAD:main --force</em>.</p>\n</blockquote>\n<p>Le frontend fonctionne aussi avec le backend sur Heroku. Vous pouvez le vérifier en changeant l'adresse du backend sur le frontend pour être l'adresse du backend dans Heroku au lieu de <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i>.</p>\n<p>La question suivante est de savoir comment déployer le frontend sur Internet. Nous avons plusieurs options. Passons en revue l'une d'entre elles ensuite. </p>\n<h3>Construction de production du frontend</h3>\n<p>Jusqu'à présent, nous avons exécuté le code React en <i>mode développement</i>. En mode développement, l'application est configurée pour donner des messages d'erreur clairs, rendre immédiatement les changements de code au navigateur, et ainsi de suite. </p>\n<p>Lorsque l'application est déployée, nous devons créer un <a href=\"https://reactjs.org/docs/optimizing-performance.html#use-the-production-build\">production build</a> ou une version de l'application qui est optimisée pour la production. </p>\n<p>Une build de production des applications créées avec <i>create-react-app</i> peut être créée avec la commande <a href=\"https://github.com/facebookincubator/create-react-app#npm-run-build-or-yarn-build\">npm run build</a>.</p>\n<p><strong>NOTE:</strong> au moment de la rédaction (20 janvier 2022) create-react-app avait un bug qui provoque l'erreur suivante <em>TypeError : MiniCssExtractPlugin n'est pas un constructeur</em>.</p>\n<p>Un correctif possible est trouvé à partir d'<a href=\"https://github.com/facebook/create-react-app/issues/11930\">ici</a>. Ajoutez ce qui suit au fichier <i>package.json</i>. </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token property\">\"resolutions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"mini-css-extract-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.4.5\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>et lancez les commandes</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rm -rf package-lock.json\nrm -rf node_modules\nnpm cache clean --force\nnpm install</code></pre></div>\n<p>Après ces commandes <em>npm run build</em> devrait fonctionner.</p>\n<p>Exécutons cette commande depuis la <i>racine du projet frontend</i>.</p>\n<p>Cela crée un répertoire appelé <i>build</i> (qui contient le seul fichier HTML de notre application, <i>index.html</i> ) qui contient le répertoire <i>static</i>. La version <a href=\"https://en.wikipedia.org/wiki/Minification_(programmation)\">minifiée</a> du code JavaScript de notre application sera générée dans le répertoire <i>static</i>. Même si le code de l'application se trouve dans plusieurs fichiers, tout le JavaScript sera minifié en un seul fichier. En fait, tout le code de toutes les dépendances de l'application sera également minifié dans ce fichier unique. </p>\n<p>Le code minifié n'est pas très lisible. Le début du code ressemble à ceci : </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">!</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">function</span> <span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>l<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>a<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>s<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>c<span class=\"token operator\">&lt;</span>i<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>c<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>f<span class=\"token operator\">=</span>i<span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>n <span class=\"token keyword\">in</span> l<span class=\"token punctuation\">)</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>l<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">p</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> u<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">,</span>a<span class=\"token operator\">||</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">function</span> <span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> e<span class=\"token punctuation\">,</span>r<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>r<span class=\"token operator\">&lt;</span>u<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>r<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>u<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>t<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> l<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token number\">0</span><span class=\"token operator\">!==</span>o<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>n<span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">--</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>e<span class=\"token operator\">=</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>s<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">}</span><span class=\"token keyword\">var</span> n<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>o<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>u<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span> n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">;</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">i</span><span class=\"token operator\">:</span>r<span class=\"token punctuation\">,</span><span class=\"token literal-property property\">l</span><span class=\"token operator\">:</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">exports</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>l<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">}</span>f<span class=\"token punctuation\">.</span>m<span class=\"token operator\">=</span>e<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span>c<span class=\"token operator\">=</span>n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">d</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span>t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">o</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">get</span><span class=\"token operator\">:</span>t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">r</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"undefined\"</span><span class=\"token operator\">!==</span><span class=\"token keyword\">typeof</span> Symbol<span class=\"token operator\">&amp;&amp;</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token operator\">&amp;&amp;</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span><span class=\"token string\">\"Module\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Servir des fichiers statiques à partir du backend</h3>\n<p>Une option pour déployer le frontend est de copier le build de production (le répertoire <i>build</i>) à la racine du dépôt du backend et de configurer le backend pour afficher le <i>main page</i> du frontend (le fichier <i>build/index.html</i>) comme page principale. </p>\n<p>Nous commençons par copier la build de production du frontend à la racine du backend. Avec un ordinateur Mac ou Linux, la copie peut être faite depuis le répertoire du frontend avec la commande</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> <span class=\"token parameter variable\">-r</span> build <span class=\"token punctuation\">..</span>/notes-backend</code></pre></div>\n<p>Si vous utilisez un ordinateur Windows, vous pouvez utiliser la commande <a href=\"https://www.windows-commandline.com/windows-copy-command-syntax-examples/\">copy</a> ou <a href=\"https://www.windows-commandline.com/xcopy-command-syntax-examples/\">xcopy</a> à la place. Sinon, faites simplement un copier-coller. </p>\n<p>Le répertoire backend devrait maintenant ressembler à ceci :</p>\n<picture><img src=\"/static/3c4c5437683d0ea2e206c80b39766136/5a190/27ea.png\" srcset=\"/static/3c4c5437683d0ea2e206c80b39766136/772e8/27ea.png 200w,\n/static/3c4c5437683d0ea2e206c80b39766136/e17e5/27ea.png 400w,\n/static/3c4c5437683d0ea2e206c80b39766136/5a190/27ea.png 800w,\n/static/3c4c5437683d0ea2e206c80b39766136/c1b63/27ea.png 1200w,\n/static/3c4c5437683d0ea2e206c80b39766136/37048/27ea.png 1352w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Pour qu'express affiche le <i>contenu statique</i>, la page <i>index.html</i> et le JavaScript, etc., qu'il récupère, nous avons besoin d'un middleware intégré à express appelé <a href=\"http://expressjs.com/en/starter/static-files.html\">static</a>.</p>\n<p>Lorsque nous ajoutons ce qui suit au milieu des déclarations de middlewares </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>chaque fois qu'express reçoit une requête HTTP GET, il vérifie d'abord si le répertoire <i>build</i> contient un fichier correspondant à l'adresse de la requête. Si un fichier correct est trouvé, express le retournera. </p>\n<p>Maintenant, les requêtes HTTP GET vers l'adresse <i>www.serversaddress.com/index.html</i> ou <i>www.serversaddress.com</i> afficheront le frontend React. Les requêtes GET vers l'adresse <i>www.serversaddress.com/api/notes</i> seront traitées par le code du backend.</p>\n<p>En raison de notre situation, le frontend et le backend sont tous deux à la même adresse, nous pouvons déclarer <em>baseUrl</em> comme une URL <a href=\"https://www.w3.org/TR/WD-html40-970917/htmlweb.html#h-5.1.2\">relative</a>. Cela signifie que nous pouvons laisser de côté la partie déclarant le serveur. </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Après le changement, nous devons créer un nouveau build de production et le copier à la racine du dépôt backend. </p>\n<p>L'application peut maintenant être utilisée depuis l'adresse <i>backend</i> <a href=\"http://localhost:3001\">http://localhost:3001</a>:</p>\n<picture><img src=\"/static/f5d8aad803a0a13ea9b29fd705774ec8/5a190/28e.png\" srcset=\"/static/f5d8aad803a0a13ea9b29fd705774ec8/772e8/28e.png 200w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/e17e5/28e.png 400w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/5a190/28e.png 800w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/c1b63/28e.png 1200w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/9685e/28e.png 1336w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Notre application fonctionne maintenant exactement comme l'application d'exemple <a href=\"/fr/part0/fundamentals_of_web_apps#single-page-app\">single-page app</a> que nous avons étudiée dans la partie 0. </p>\n<p>Lorsque nous utilisons un navigateur pour aller à l'adresse <a href=\"http://localhost:3001\">http://localhost:3001</a>, le serveur renvoie le fichier <i>index.html</i> à partir du <i>build</i> du dépôt. Le contenu résumé de ce fichier est le suivant : </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/css/main.f9a47af2.chunk.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/js/1.578f4ea1.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.104ca08d.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Le fichier contient des instructions pour récupérer une feuille de style CSS définissant les styles de l'application, et deux balises <i>script</i> qui indiquent au navigateur de récupérer le code JavaScript de l'application - l'application React réelle. </p>\n<p>Le code React va chercher les notes à l'adresse du serveur <a href=\"http://localhost:3001/api/notes\">http://localhost:3001/api/notes</a> et les rend à l'écran. Les communications entre le serveur et le navigateur peuvent être vues dans l'onglet <i>Réseau</i> de la console du développeur :</p>\n<picture><img src=\"/static/6f63795c7abedc6d9afbc405f0642aeb/5a190/29ea.png\" srcset=\"/static/6f63795c7abedc6d9afbc405f0642aeb/772e8/29ea.png 200w,\n/static/6f63795c7abedc6d9afbc405f0642aeb/e17e5/29ea.png 400w,\n/static/6f63795c7abedc6d9afbc405f0642aeb/5a190/29ea.png 800w,\n/static/6f63795c7abedc6d9afbc405f0642aeb/c1b63/29ea.png 1200w,\n/static/6f63795c7abedc6d9afbc405f0642aeb/29007/29ea.png 1600w,\n/static/6f63795c7abedc6d9afbc405f0642aeb/10d53/29ea.png 1724w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>La configuration prête pour le déploiement du produit se présente comme suit :</p>\n<picture><img src=\"/static/6f33425b60b49278d57df7e62f81a32c/db910/101.png\" srcset=\"/static/6f33425b60b49278d57df7e62f81a32c/772e8/101.png 200w,\n/static/6f33425b60b49278d57df7e62f81a32c/db910/101.png 396w\" sizes=\"(max-width: 396px) 100vw, 396px\"></picture>\n<p>Contrairement à ce qui s'est passé lors de l'exécution de l'application dans un environnement de développement, tout est maintenant dans le même node/express-backend qui s'exécute dans localhost:3001. Lorsque le navigateur se rend sur la page, le fichier <i>index.html</i> est rendu. Cela amène le navigateur à récupérer la version produit de l'application React. Une fois qu'elle commence à s'exécuter, elle récupère les données json de l'adresse localhost:3001/api/notes.</p>\n<h3>L'application entière sur internet</h3>\n<p>Après vous être assuré que la version de production de l'application fonctionne localement, faites un commit du build de production du frontend dans le dépôt principal et faites à nouveau un push du code à Heroku. </p>\n<p><a href=\"https://obscure-harbor-49797.herokuapp.com/\">L'application</a> fonctionne parfaitement, sauf que nous n'avons pas encore ajouté la fonctionnalité pour changer l'importance d'une note au backend. </p>\n<picture><img src=\"/static/cde873f94e045e8d1a07b4d4a1a59bf9/5a190/30ea.png\" srcset=\"/static/cde873f94e045e8d1a07b4d4a1a59bf9/772e8/30ea.png 200w,\n/static/cde873f94e045e8d1a07b4d4a1a59bf9/e17e5/30ea.png 400w,\n/static/cde873f94e045e8d1a07b4d4a1a59bf9/5a190/30ea.png 800w,\n/static/cde873f94e045e8d1a07b4d4a1a59bf9/c1b63/30ea.png 1200w,\n/static/cde873f94e045e8d1a07b4d4a1a59bf9/0f586/30ea.png 1498w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Notre application enregistre les notes dans une variable. Si l'application se plante ou est redémarrée, toutes les données disparaîtront. </p>\n<p>L'application a besoin d'une base de données. Avant d'en introduire une, passons en revue quelques éléments. </p>\n<p>La configuration ressemble maintenant à ce qui suit :</p>\n<picture><img src=\"/static/f66a6db377fe19444ecd3bea78c49d4b/5a190/102.png\" srcset=\"/static/f66a6db377fe19444ecd3bea78c49d4b/772e8/102.png 200w,\n/static/f66a6db377fe19444ecd3bea78c49d4b/e17e5/102.png 400w,\n/static/f66a6db377fe19444ecd3bea78c49d4b/5a190/102.png 800w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Le node/express-backend réside maintenant dans le serveur Heroku. Lorsque l'on accède à l'adresse racine qui est de la forme <a href=\"https://glacial-ravine-74819.herokuapp.com/\">https://glacial-ravine-74819.herokuapp.com/</a>, le navigateur charge et exécute l'application React qui récupère les données json du serveur Heroku.</p>\n<h3>Rationalisation du déploiement du front-end</h3>\n<p>Pour créer une nouvelle construction de production du frontend sans travail manuel supplémentaire, ajoutons quelques npm-scripts au <i>package.json</i> du dépôt du backend : </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    <span class=\"token property\">\"build:ui\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rm -rf build &amp;&amp; cd ../part2-notes/ &amp;&amp; npm run build &amp;&amp; cp -r build ../notes-backend\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git push heroku main\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy:full\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build:ui &amp;&amp; git add . &amp;&amp; git commit -m uibuild &amp;&amp; npm run deploy\"</span><span class=\"token punctuation\">,</span>    \n    <span class=\"token property\">\"logs:prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"heroku logs --tail\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Le script <em>npm run build:ui</em> construit le frontend et copie la version de production sous le dépôt backend.  <em>npm run deploy</em> libère le backend actuel sur Heroku. </p>\n<p><em>npm run deploy:full</em> combine ces deux-là et contient les commandes <i>git</i> nécessaires pour mettre à jour le dépôt backend. </p>\n<p>Il existe également un script <em>npm run logs:prod</em> pour afficher les logs de heroku.</p>\n<p>Notez que les chemins de répertoire dans le script <i>build:ui</i> dépendent de l'emplacement des dépôts dans le système de fichiers.</p>\n<blockquote>\n<p><strong>NB</strong> Sous Windows, les scripts npm sont exécutés dans cmd.exe comme shell par défaut qui ne supporte pas les commandes bash. Pour que les commandes bash ci-dessus fonctionnent, vous pouvez changer le shell par défaut en Bash (dans l'installation par défaut de Git pour Windows) comme suit :</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">npm config set script-shell \"C:\\\\Program Files\\\\git\\\\bin\\\\bash.exe\"</code></pre></div>\n<p>Une autre option est l'utilisation de <a href=\"https://www.npmjs.com/package/shx\">shx</a>.</p>\n<h3>Proxy</h3>\n<p>Des modifications apportées au frontend ont fait qu'il ne fonctionne plus en mode développement (lorsqu'il est lancé avec la commande <em>npm start</em>), car la connexion au backend ne fonctionne pas. </p>\n<picture><img src=\"/static/19026b5379d1feef11ecc20ca2f669a9/5a190/32ea.png\" srcset=\"/static/19026b5379d1feef11ecc20ca2f669a9/772e8/32ea.png 200w,\n/static/19026b5379d1feef11ecc20ca2f669a9/e17e5/32ea.png 400w,\n/static/19026b5379d1feef11ecc20ca2f669a9/5a190/32ea.png 800w,\n/static/19026b5379d1feef11ecc20ca2f669a9/c1b63/32ea.png 1200w,\n/static/19026b5379d1feef11ecc20ca2f669a9/07d7d/32ea.png 1478w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Ceci est dû au changement de l'adresse du backend en une URL relative : </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></code></pre></div>\n<p>Parce qu'en mode développement, le frontend est à l'adresse <i>localhost:3000</i>, les requêtes vers le backend vont à la mauvaise adresse <i>localhost:3000/api/notes</i>. Le backend se trouve à <i>localhost:3001</i>. </p>\n<p>Si le projet a été créé avec create-react-app, ce problème est facile à résoudre. Il suffit d'ajouter la déclaration suivante au fichier <i>package.json</i> du dépôt du frontend. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"dependencies\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"scripts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"proxy\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"http://localhost:3001\"</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Après un redémarrage, l'environnement de développement React fonctionnera comme un <a href=\"https://create-react-app.dev/docs/proxying-api-requests-in-development/\">proxy</a>. Si le code React fait une requête HTTP vers une adresse de serveur à <i><a href=\"http://localhost:3000\">http://localhost:3000</a></i> non gérée par l'application React elle-même (c'est-à-dire lorsque les requêtes ne consistent pas à récupérer le CSS ou le JavaScript de l'application), la requête sera redirigée vers le serveur à <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i>. </p>\n<p>Maintenant, le frontend est aussi bien, travaillant avec le serveur à la fois en mode développement et en mode production. </p>\n<p>Un aspect négatif de notre approche est la complexité du déploiement du frontend. Le déploiement d'une nouvelle version nécessite de générer un nouveau build de production du frontend et de le copier dans le dépôt du backend. Cela rend la création d'un [pipeline de déploiement] automatisé (<a href=\"https://martinfowler.com/bliki/DeploymentPipeline.html\">https://martinfowler.com/bliki/DeploymentPipeline.html</a>) plus difficile. Un pipeline de déploiement est un moyen automatisé et contrôlé de faire passer le code de l'ordinateur du développeur à l'environnement de production en passant par différents tests et contrôles de qualité. La construction d'un pipeline de déploiement est le sujet de la <a href=\"https://fullstackopen.com/en/part11\">partie 11</a> de ce cours.</p>\n<p>Il existe de multiples façons d'y parvenir (par exemple en plaçant le code backend et frontend <a href=\"https://github.com/mars/heroku-cra-node\">dans le même dépôt</a> ) mais nous ne nous y attarderons pas maintenant. </p>\n<p>Dans certaines situations, il peut être judicieux de déployer le code frontal comme une application à part entière. Avec les applications créées avec create-react-app, c'est [simple] (<a href=\"https://github.com/mars/create-react-app-buildpack\">https://github.com/mars/create-react-app-buildpack</a>).</p>\n<p>Le code actuel du backend peut être trouvé sur <a href=\"https://github.com/fullstack-hy2020/part3-notes-backend/tree/part3-3\">Github</a>, dans la branche <i>part3-3</i>. Les modifications du code du frontend se trouvent dans la branche <i>part3-1</i> du <a href=\"https://github.com/fullstack-hy2020/part2-notes/tree/part3-1\">dépôt du frontend</a>.</p>\n</div>\n<div class=\"tasks\">\n<h3>Exercices 3.9.-3.11.</h3>\n<p>Les exercices suivants ne nécessitent pas beaucoup de lignes de code. Ils peuvent cependant constituer un défi, car vous devez comprendre exactement ce qui se passe et où, et les configurations doivent être justes. </p>\n<h4>3.9 backend du répertoire téléphonique étape9</h4>\n<p>Faites fonctionner le backend avec le frontend phonebook des exercices de la partie précédente. N'implémentez pas encore la fonctionnalité permettant de modifier les numéros de téléphone, qui sera implémentée dans l'exercice 3.17. </p>\n<p>Vous devrez probablement faire quelques petits changements au frontend, au moins aux URLs pour le backend. N'oubliez pas de garder la console de développement ouverte dans votre navigateur. Si certaines requêtes HTTP échouent, vous devriez vérifier à partir de l'onglet <i>Réseau</i> ce qui se passe. Gardez également un oeil sur la console du backend. Si vous n'avez pas fait l'exercice précédent, il vaut la peine d'imprimer les données de la requête ou <i>request.body</i> à la console dans le gestionnaire d'événements responsable des requêtes POST. </p>\n<h4>3.10 backend répertoire téléphonique étape10</h4>\n<p>Déployez le backend sur internet, par exemple sur Heroku. </p>\n<p><strong>NB</strong> la commande <em>heroku</em> fonctionne sur les ordinateurs du département et les ordinateurs portables des étudiants de première année. Si pour une raison quelconque vous ne pouvez pas <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">installer</a> Heroku sur votre ordinateur, vous pouvez utiliser la commande <a href=\"https://www.npmjs.com/package/heroku\">npx heroku</a>.</p>\n<p>Testez le backend déployé avec un navigateur et le client REST Postman ou VS Code pour vous assurer qu'il fonctionne. </p>\n<p><strong>PRO TIP:</strong> Lorsque vous déployez votre application sur Heroku, il vaut la peine, au moins au début, de garder un oeil sur les logs de l'application heroku <strong>TOUT LE TEMPS</strong> avec la commande <em>heroku logs -t</em>.</p>\n<p>Ce qui suit est un log concernant un problème typique. Heroku ne peut pas trouver la dépendance d'application <i>express</i> :</p>\n<picture><img src=\"/static/9c32d4d565c7179d84334ba086ed03b9/5a190/33.png\" srcset=\"/static/9c32d4d565c7179d84334ba086ed03b9/772e8/33.png 200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/e17e5/33.png 400w,\n/static/9c32d4d565c7179d84334ba086ed03b9/5a190/33.png 800w,\n/static/9c32d4d565c7179d84334ba086ed03b9/c1b63/33.png 1200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/29007/33.png 1600w,\n/static/9c32d4d565c7179d84334ba086ed03b9/6e29b/33.png 1610w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>La raison est que le paquet <i>express</i> n'a pas été installé avec la commande <em>npm install express</em>, donc les informations sur la dépendance n'ont pas été enregistrées dans le fichier <i>package.json</i>.</p>\n<p>Un autre problème typique est que l'application n'est pas configurée pour utiliser le port défini dans la variable d'environnement <em>PORT</em> : </p>\n<picture><img src=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/5a190/34.png\" srcset=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/772e8/34.png 200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/e17e5/34.png 400w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/5a190/34.png 800w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/c1b63/34.png 1200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/ae28e/34.png 1598w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Créez un README.md à la racine de votre dépôt, et ajoutez-y un lien vers votre application en ligne. </p>\n<h4>3.11 phonebook full stack</h4>\n<p>Générez un build de production de votre frontend, et ajoutez-le à l'application internet en utilisant la méthode introduite dans cette partie. </p>\n<p><strong>NB</strong> Assurez-vous que le répertoire <i>build</i> n'est pas gitignored.</p>\n<p>Assurez-vous également que le frontend fonctionne toujours localement (en mode développement lorsqu'il est lancé avec la commande <em>npm start</em>). </p>\n<p>Si vous avez des problèmes pour faire fonctionner l'application, assurez-vous que votre structure de répertoire correspond à celle de <a href=\"https://github.com/fullstack-hy2020/part3-notes-backend/tree/part3-3\">l'application d'exemple</a>.</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/8ac7bc0fb2b7018a7853b00c454b2103/part-3.svg"},"part":3,"letter":"b","lang":"fr"}}},"pageContext":{"part":3,"letter":"b","lang":"fr"}},"staticQueryHashes":["3128451518"]}